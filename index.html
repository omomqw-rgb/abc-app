<!DOCTYPE html>

<html lang="ko">
<head>
<link href="data:," rel="icon"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>대부 코어 v0.6.5 — 캘린더 잔액반영 · 스케줄 글자색 · 월단위 제거</title>
<link rel="stylesheet" href="css/style_001.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="css/style_002.css"/>
<!-- ===== Patch: Debtor table margin & horizontal scroll (mobile-first) ===== -->
<link rel="stylesheet" href="css/style_003.css"/>
<!-- ===== Patch: 합계표( sum-row ) 모바일 하단 이동 & 고정 해제 + 표 가로스크롤 ===== -->
<link rel="stylesheet" href="css/style_004.css"/>
<!-- ===== Mobile debtor reflow patch ===== -->
<link rel="stylesheet" href="css/style_005.css"/>
<!-- /Mobile debtor reflow patch -->
<!-- === Mobile debtor-attach & scroll fix (final) === -->
<link rel="stylesheet" href="css/style_006.css"/>
<link rel="stylesheet" href="css/style_007.css"/></head>
<body>
<!-- Toast will be loaded via the module bootstrap -->
<div class="app">
<div class="topbar">
<div class="brand">💼 대부 코어 v0.6.5</div>
<button class="tab active" data-tab="calendar">전체관리(캘린더)</button>
<button class="tab" data-tab="debtors">채무자 관리</button><button class="tab" data-tab="stats">통계</button>
<div class="spacer"></div>
<button class="btn" id="btnExport">백업 내보내기</button>
<button class="btn" id="btnImport">백업 불러오기</button>
<button class="btn" id="btnAuth">로그인</button>
<button class="btn" id="btnCloudSave">클라우드 저장</button>
<button class="btn" id="btnCloudLoad">클라우드 불러오기</button>
<input accept="application/json" id="importFile" style="display:none" type="file"/>
</div>
<!-- LEFT -->
<aside class="side">
<div class="head">
<strong>채무자</strong>
<button class="btn" id="btnAddDebtor">+ 추가</button>
</div>
<div class="body"><div id="debtorCtrlBar" style="display:flex;gap:8px;align-items:center;margin:8px 8px 6px 8px"><button class="icon-btn" id="btnSortName">이름순</button><button class="icon-btn" id="btnSortDate">생성일순</button><input id="debtorSearch" placeholder="검색 (이름/메모)" style="flex:1;min-width:0;padding:6px 10px;border-radius:8px;border:1px solid #3a4869" type="search"/></div><div id="debtorList"></div></div>
</aside>
<!-- MAIN -->
<main class="main">
<!-- 캘린더 -->
<section class="card" id="view-calendar">
<div class="grid-tools">
<button class="btn" id="prevMonth">◀</button>
<select id="yearSel"></select>
<select id="monthSel"></select>
<button class="btn" id="nextMonth">▶</button>
<button class="btn" id="todayBtn">오늘</button>
<div class="spacer"></div>
<button class="btn" id="btnNewLoan">+ 대출 등록</button>
<button class="btn" id="btnNewRepay">+ 채무상환</button>
</div>
<div class="calendar">
<div class="cal-head">
<div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
</div>
<div class="cal-grid" id="calGrid"></div>
</div>
<div class="note" style="margin-top:8px">
        색상: <b style="color:#2ecc71">초록=완납</b> · <b style="color:#ffd048">노랑=부분</b> · <b style="color:#ff5252">빨강=미납</b> · <b>흰색=도래전</b> | 오늘=빨간 테두리
      </div>
</section>
<!-- 채무자 관리 -->
<section class="card" id="view-debtors" style="display:none">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
<h3 style="margin:0">채무자 관리</h3>
<!-- 가운데 +대출 등록 버튼 제거 -->
</div>
<!-- 알림 보드 -->
<div id="alertsWrap"></div>
<!-- 모바일: 채무자 목록 인라인 (<=860px) -->
<div id="mobileDebtorListWrap" style="display:none;margin:10px 0 6px 0">
<h4 style="margin:0 0 6px 0">채무자 목록</h4>
<div id="debtorListMobile"></div>
</div>
<!-- 채무자 표 -->
</section><section class="card" id="view-stats" style="display:none">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
<h3 style="margin:0">통계</h3>
</div>
<div class="stats-tabs">
<button class="stats-tab active" data-stats="loan">대출</button>
<button class="stats-tab" data-stats="claim">채권</button>
<button class="stats-tab" data-stats="sum">합계</button>
<button class="stats-tab" data-stats="roi">수익률</button>
</div>
<div id="statsBody"></div>
</section>
</main>
<!-- RIGHT: Drawer -->
<aside class="drawer">
<div class="head" style="padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center">
<strong id="drawerName">채무자 상세</strong>
<div style="display:flex;gap:6px">
<button class="btn" id="btnEditDebtor">수정</button>
<button class="btn" id="btnNewLoanDrawer">+ 대출</button>
<button class="btn" id="btnNewRepayDrawer">+ 채무상환</button>
</div>
</div>
<div class="kpis" id="drawerKpis"></div>
<div class="loan-list" id="drawerLoans"></div>
</aside>
</div>
<!-- 모달들 -->
<div class="modal-backdrop" id="debtorModal">
<div class="modal">
<h3 id="debtorModalTitle">채무자 추가</h3>
<div class="row"><label>이름</label><input id="debtorName"/></div>
<div class="row"><label>연락처</label><input id="debtorPhone" placeholder="선택"/></div>
<div class="row"><label>메모</label><input id="debtorNote" placeholder="예: 월말 70만 합의"/></div>
<div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
<button class="btn" data-close="#debtorModal">취소</button>
<button class="btn" id="saveDebtor">저장</button>
</div>
</div>
</div>
<div class="modal-backdrop" id="loanModal">
<div class="modal">
<h3 id="loanModalTitle">대출 등록</h3>
<div class="row"><label>채무자</label><select id="loanDebtor"></select></div>
<div class="row"><label>총상환금액</label><input id="loanTotal" inputmode="numeric" placeholder="예: 1200000" type="number"/></div>
<div class="row"><label>이자율(%)</label><input id="loanRate" type="number" inputmode="decimal" min="0" step="0.1" placeholder="예: 20"/></div>
<div class="row"><label>회차 수</label><input id="loanCount" inputmode="numeric" min="1" type="number" value="10"/></div>
<div class="row"><label>시작일</label><input id="loanStart" type="date"/></div>
<div class="row"><label>상환 주기</label>
<select id="loanFreq">
<option value="daily">일간격</option>
<option value="weekly">주간격(요일 지정)</option>
<option value="month_end">월말</option>
</select>
</div>
<div class="row" id="rowDaily" style="display:none"><label>일 간격</label><input id="loanDailyInterval" min="1" type="number" value="7"/></div>
<div class="row" id="rowWeekly" style="display:none"><label>요일</label>
<select id="loanWeekday">
<option value="0">일</option><option value="1">월</option><option value="2">화</option>
<option value="3">수</option><option value="4">목</option><option value="5">금</option><option value="6">토</option>
</select>
</div>
<div class="row"><label>옵션</label>
<label style="display:flex;align-items:center;gap:6px"><input id="optFirstPaid" type="checkbox"/> 1회차 동시상환</label>
</div>
<div class="row"><label>미리보기</label><div class="note" id="previewLoan"></div></div>
<div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
<button class="btn" data-close="#loanModal">취소</button>
<button class="btn" id="saveLoan">저장</button>
</div>
</div>
</div>
div class="modal-backdrop" id="payModal">
<div class="modal">
<h3>회차 입금 처리</h3>
<div class="row"><label>채무자</label><div id="payWho"></div></div>
<div class="row"><label>회차/일자</label><div id="payWhen"></div></div>
<div class="row"><label>금액</label><div id="payAmt"></div></div>
<div class="row"><label>기 납입</label><div id="payPaid"></div></div>
<div class="row"><label>추가 납입</label><input id="payAdd" inputmode="numeric" placeholder="부분입금 금액" type="number"/></div>
<div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
<button class="btn" data-close="#payModal">닫기</button>
<button class="btn" id="btnMissed">미납</button>
<button class="btn" id="btnPartial">부분입금</button>
<button class="btn" id="btnSettle">완납</button>
</div>
</div>
</div>
  <!-- All local scripts are now loaded via the module bootstrap -->

<div id="patchToast" style="position:fixed;right:12px;top:12px;z-index:99999;display:flex;flex-direction:column;gap:8px;"></div>
<!-- auth modal (patch) -->
<div class="modal-backdrop" id="authModal" style="display:none;align-items:center;justify-content:center">
<div class="modal" style="max-width:420px">
<h3>로그인</h3>
<div class="row"><label>이메일</label><input autocomplete="username" id="authEmail" type="email"/></div>
<div class="row"><label>비밀번호</label><input autocomplete="current-password" id="authPw" type="password"/></div>
<div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
<button class="btn" data-close="#authModal">취소</button>
<button class="btn" id="authSubmit">로그인</button>
</div>
</div>
</div>
<!-- ===== Patch v4 (final): safe click-capture + modal + toast ===== -->
  <!-- auth patch is loaded via the module bootstrap -->
<!-- 채무상환 등록 모달 -->
<div class="modal-backdrop" id="repayAddModal" style="display:none;align-items:center;justify-content:center">
<div class="modal">
<h3>채무상환 등록</h3>
<div class="row"><label>채무자</label><select id="rpDebtor"></select></div>
<div class="row"><label>총상환채무</label><input id="rpTotal" inputmode="numeric" placeholder="예: 12000000" type="number"/></div>
<div class="row"><label>회차 수</label><input id="rpCount" inputmode="numeric" min="1" type="number" value="10"/></div>
<div class="row"><label>시작일</label><input id="rpStart" type="date"/></div>
<div class="row"><label>상환 주기</label>
<select id="rpFreq">
<option value="daily">일간격</option>
<option value="weekly">주간격(요일 지정)</option>
<option value="month_end">월말</option>
</select>
</div>
<div class="row" id="rpRowDaily" style="display:none"><label>일 간격</label><input id="rpDaily" min="1" type="number" value="1"/></div>
<div class="row" id="rpRowWeekly" style="display:none"><label>요일</label>
<select id="rpWeekday">
<option value="0">일</option><option value="1">월</option><option value="2">화</option><option value="3">수</option>
<option value="4">목</option><option value="5">금</option><option value="6">토</option>
</select>
</div>
<div class="row"><label>미리보기</label><div class="note" id="rpPreview"></div></div>
<div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
<button class="btn" data-close="#repayAddModal">취소</button>
<button class="btn" id="rpSave">저장</button>
</div>
</div>
</div>
  <!-- domain and UI scripts are loaded via the module bootstrap -->
  <!-- Compat-ESM bootstrap -->
  <script type="module" src="js/app.bootstrap.js"></script>
</body>
</html>
